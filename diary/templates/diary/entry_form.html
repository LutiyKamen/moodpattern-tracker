{% extends 'diary/base.html' %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">{{ title }}</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}

                    <!-- –ü–æ–ª–µ —Ç–µ–∫—Å—Ç–∞ -->
                    <div class="mb-4">
                        <label for="{{ form.text.id_for_label }}" class="form-label">{{ form.text.label }}</label>
                        {{ form.text }}
                        {% if form.text.help_text %}
                        <div class="form-text">{{ form.text.help_text }}</div>
                        {% endif %}
                        {% if form.text.errors %}
                        <div class="alert alert-danger mt-2">
                            {{ form.text.errors }}
                        </div>
                        {% endif %}
                    </div>

                    <!-- –ü–æ–ª–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è -->
                    <div class="mb-4">
                        <label for="{{ form.user_mood_tag.id_for_label }}" class="form-label">{{ form.user_mood_tag.label }}</label>
                        {{ form.user_mood_tag }}
                        {% if form.user_mood_tag.errors %}
                        <div class="alert alert-danger mt-2">
                            {{ form.user_mood_tag.errors }}
                        </div>
                        {% endif %}
                    </div>

                    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h6>üéØ –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –º–µ—Ç–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è:</h6>
                            <div class="row">
                                <div class="col">
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-success me-2">–û—Ç–ª–∏—á–Ω–æ–µ</span>
                                        <small>–û—â—É—â–µ–Ω–∏–µ —Å—á–∞—Å—Ç—å—è, —ç–Ω—Ç—É–∑–∏–∞–∑–º–∞</small>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-info me-2">–•–æ—Ä–æ—à–µ–µ</span>
                                        <small>–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ</small>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-secondary me-2">–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ</span>
                                        <small>–ë–µ–∑ –æ—Å–æ–±—ã—Ö —ç–º–æ—Ü–∏–π</small>
                                    </div>
                                </div>
                                <div class="col">
                                    <div class="d-flex align-items-center mb-2">
                                        <span class="badge bg-warning me-2">–ü–ª–æ—Ö–æ–µ</span>
                                        <small>–†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ, –≥—Ä—É—Å—Ç—å</small>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-danger me-2">–£–∂–∞—Å–Ω–æ–µ</span>
                                        <small>–°–∏–ª—å–Ω—ã–π —Å—Ç—Ä–µ—Å—Å, –ø–æ–¥–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary me-2">–û—Ç–º–µ–Ω–∞</a>
                        <button type="submit" class="btn btn-primary">
                            {% if title == '–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å' %}–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å{% else %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ü–æ–¥—Å—á–µ—Ç —Å–ª–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
document.getElementById('{{ form.text.id_for_label }}').addEventListener('input', function() {
    const text = this.value;
    const wordCount = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
    const counter = document.getElementById('word-counter');

    if (!counter) {
        // –°–æ–∑–¥–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        const counterElement = document.createElement('div');
        counterElement.id = 'word-counter';
        counterElement.className = 'form-text mt-1';
        this.parentNode.appendChild(counterElement);
    }

    document.getElementById('word-counter').textContent =
        `–°–ª–æ–≤: ${wordCount} (–º–∏–Ω–∏–º—É–º 10)`;

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –µ—Å–ª–∏ –º–∞–ª–æ —Å–ª–æ–≤
    if (wordCount < 10) {
        document.getElementById('word-counter').style.color = '#dc3545';
    } else {
        document.getElementById('word-counter').style.color = '#198754';
    }
});
</script>
{% endblock %}